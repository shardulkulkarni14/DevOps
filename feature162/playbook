# playbook.yml

---
- name: Configure Web Servers and Load Balancer
  hosts: master.local
  become: true
  gather_facts: true

  tasks:
    - name: Install Nginx on node1.local
      apt:
        name: nginx
        state: present
        update_cache: yes

    - name: Configure Nginx as a load balancer
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
      notify: restart nginx

    - name: Start Nginx service
      service:
        name: nginx
        state: started

    - name: Install Apache2 on node2.local
      apt:
        name: apache2=2.4.41-4ubuntu3.14
        state: present
        update_cache: yes

    - name: Set up Apache2 homepage
      template:
        src: index.html.j2
        dest: /var/www/html/index.html

    - name: Restart Apache2 service
      service:
        name: apache2
        state: restarted

    - name: Install Tomcat on node3.local
      apt:
        name: default-jdk
        state: present

    - name: Download and extract Tomcat
      get_url:
        url: https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.37/bin/apache-tomcat-9.0.37.tar.gz
        dest: /usr/local
      args:
        creates: /usr/local/apache-tomcat-9.0.37  # Skip if Tomcat is already present

    - name: Web server home page configuration for Tomcat
      template:
        src: tomcat-index.html.j2
        dest: /usr/local/apache-tomcat-9.0.37/webapps/ROOT/index.html

    - name: Start Tomcat service
      command: /usr/local/apache-tomcat-9.0.37/bin/startup.sh

  handlers:
    - name: restart nginx
      service:
        name: nginx
        state: restarted
